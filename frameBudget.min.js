/*
@preserve
    Author: WONG LOK
    Github: wonglok
    License: Apache v2
*/
/*
@preserve
requestAnimationFrame Polyfill
    http://paulirish.com/2011/requestanimationframe-for-smart-animating/
    http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
    requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel
    MIT license

ArrayFilter:
    Credit: MDN (Mozilla Developer Network)

Consle Polyfill:
    HTML5 Boilerplat
*/
!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),function(a){"use strict";function b(){function b(a){a&&(D?console.log("You are using estimator"):(a>1e3/60&&(console.warn("***** You are might be specifying too much frame budget: "+a+"ms"),a=1e3/60),F=a))}function c(){function b(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}function c(a,b,c){return!0&&a<Math.max.apply(null,c)&&a>Math.min.apply(null,c)}function d(a,b){for(var d=0;b>=d;d++)a=a.filter(c);return a}function e(){var a=d(j,G),c=b(a);return L&&console.info(a,j),c}function f(){if(j.push(a.performance.now()-i),j.length<=H)requestAnimationFrame(g);else{var b=e();h(b)}}function g(){i=a.performance.now(),requestAnimationFrame(f)}function h(a){J=!0,F=a*I,L&&console.debug({frameBudget:a,afterCalc:F}),q()}var i,j=[];g()}function d(){DEBUG.ENABLED=!DEBUG.ENABLED}function e(){function b(a){e=L&&h>z,e&&(g=0,f=a,console.log(z,"Start","Renderer",A))}function c(){e&&g++}function d(){e&&console.log(z,"Ended","taskDone",g,"budget",F.toFixed(2),"used",(a.performance.now()-f).toFixed(2))}var e,f,g,h=100;return{frameStart:b,frameEnd:d,taskDoneUpdate:c}}function f(){var b=a.performance.now();v.frameStart(b),A&&C.fn.apply(C.ctx,C.args);do{var c=y.shift();"undefined"!=typeof c&&"function"==typeof c.process&&("undefined"!=typeof c.args?c.process.apply(c.ctx,c.args):c.process.call(c.ctx,c.data),v.taskDoneUpdate())}while(a.performance.now()-b<F&&y.length>0);v.frameEnd(),k()}function g(){z=requestAnimationFrame(g),f()}function h(){z=requestAnimationFrame(g),L&&console.info("~~RAF Loop Started")}function i(){x=!1,cancelAnimationFrame(z),L&&console.info("**RAF Loop Stopped")}function j(){x||(x=!0,h())}function k(){0!==y.length||A||i()}function l(a){y.push(a)}function m(a){l(a),a.skipAutoStart||j()}function n(){y.length>0&&j()}function o(a){"undefined"!=typeof a&&("function"==typeof a.fn&&(C.fn=a.fn,A=!0),"undefined"!=typeof a.ctx&&(C.ctx=a.ctx),"undefined"!=typeof a.args&&(C.args=a.args))}function p(a){var b,c=K[a];if(c)for(var d=0;d<c.length;d++)b=c[d],b.fn.apply(this,b.args);K[a]=null}function q(){p("addTask"),p("addTaskAdv"),p("digest")}function r(a,b,c){J?b.apply(this,c):(K[a]||(K[a]=[]),K[a].push({args:c,fn:b}))}function s(){r("addTask",m,arguments)}function t(){r("digest",n,arguments)}function u(a){var b=a[0];"undefined"==typeof b||("undefined"!=typeof b.renderer&&(o(b.renderer),D=!0),"undefined"!=typeof b.noDebug&&b.noDebug===!1&&(L=!1)),D?(J=!1,c()):J=!0}var v,w=this,x=(function(){return!this}(),!1),y=[],z=0,A=!1,B=function(){},C={ctx:null,fn:B,args:[]},D=!1,E=5,F=E,G=5,H=5+2*G,I=.75,J=!1,K={addTaskAdv:[],addTask:[],digest:[]},L=!0;return v=e(),u(arguments),w.addTask=s,w.digest=t,w.toggleDebug=d,w.setFrameBudget=b,w.startLoop=h,w.stopLoop=i,w.stepper=f,w.addTaskManaul=s,w.setRenderer=o,w.guess=c,this}a.FrameBudgetTaskManager=b}(this);
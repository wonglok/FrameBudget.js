<html>
<head>
	<title></title>
	<script src="./frameBudget.js"></script>
</head>
<body>
	Refer to console

	<script>

		var renderCtx = this;
		function render(){
			console.log('darw frame');
		}

		var tmRAF = FrameBudgetTaskManager;
		//not a part of library
		//just for organising the code of different use cases
		function myUseCase(mode){
			// use case 1
			// uses default 5ms budget
			if (mode === 1){
				tmRAF = new tmRAF();
			}

			// use case 2
			// specify budget wtih 2ms
			if (mode === 2){
				tmRAF = new tmRAF();
				tmRAF.setFrameBudget(10);
			}

			// use case 3
			// manager will estimate frame then use the renderer
			// let the frame budget manager handle
			// your renderer and async task
			if (mode === 3){
				tmRAF = new tmRAF({
					//you dont need to specify frame budget
					//because the estimator will handle it.
					renderer: {
						fn: render,
						// ctx: renderCtx, //optinal
						//args: [] //optional
					}
				});
			}

			// use case 4
			// no debug
			if (mode === 4){
				tmRAF = new tmRAF({
					noDebug: true,
					renderer: {
						fn: render,
						// ctx: renderCtx, //optinal
						//args: [] //optional
					}
				});
			}

			// use case 5
			// no debug during run time.
			if (mode === 5){
				tmRAF = new tmRAF({
					renderer: {
						fn: render,
						// ctx: renderCtx, //optinal
						//args: [] //optional
					}
				});
				tmRAF.toggleDebug();
			}


		}
		myUseCase(3);


		function fib(n) {
		  return n < 2 ? 1 : fib(n - 1) + fib(n - 2);
		}

		var myCustomObj = {
		    data: [],
		    before: function(){

		    },
		    tinyTask: function (i){
		        this.before();

		        var val = this.data[i];
		        var result = fib(val);

		        //console.log(result);
		        this.bucket[i] = result;


		        this.finish();

		    },
		    finish: function(){
		    	//check end
		        if (this.bucket.length === this.data.length){
		            this.callback();
		        }else{
		            console.log(this.data.length - this.bucket.length);
		        }
		    },
		    bucket: [],
		    callback: function(){
		        console.log(this);
		    },
		};

		//populate data
		for (var i =0 ; i< 30; i++){
		    myCustomObj.data[i] = 30-i;
		}

		function taskAdder(i, useCase){
			if (useCase === 1){
				requestAnimationFrame(function(){
			        tmRAF.addTask({
			            ctx: myCustomObj,
			            data: i,
			            process: myCustomObj.tinyTask,

			            // wait: true,
			                // enable order of task adding
				            // p.s. neeeds to call 'Digest' to run all waited tasks.
				            // cannot use

			        });
			    });

			}

			if (useCase === 2){
				tmRAF.addTask({
				    ctx: myCustomObj,
				    args: [ i ],
				    process: myCustomObj.tinyTask,
				});
			}

		}

		for (var i =0 ; i< myCustomObj.data.length; i++){
		    taskAdder(i,1);
		}
		tmRAF.digest();


	</script>

</body>
